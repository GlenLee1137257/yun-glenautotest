# Glen 压测引擎 - 完整配置使用手册

> **文档版本**: v1.0  
> **更新日期**: 2026年1月21日  
> **适用场景**: 面试演示、性能/容量评估、项目完整功能测试  
> **典型业务**: 在线教育平台、电商平台等 Web 系统

---

## 一、压测引擎概述

### 1.1 功能定位

Glen 压测引擎是 Glen 自动化云测平台中的一部分，主要用于：

- **接口层压测**：对关键 HTTP 接口进行高并发压测，验证响应时间与稳定性  
- **业务场景压测**：基于完整业务流程（如下单、支付、选课）构造压测脚本  
- **容量与极限测试**：通过逐步升高并发，评估系统极限与容量阈值  
- **回归性能对比**：版本升级后对关键接口做性能对比，防止性能回退  

压测引擎与接口自动化、UI 自动化的关系：

- **接口自动化**：关注「功能正确性」  
- **UI 自动化**：关注「端到端业务流程是否正常」  
- **压测引擎**：关注「在高并发/长时间场景下是否还能保持可接受性能」

### 1.2 典型业务场景

手册主要基于以下两类业务进行演示：

- **在线教育平台（已在接口自动化手册中使用）**
  - 课程列表查询 / 课程详情 / 下单购买 / 学习记录查询
  - 典型压测目标：课程列表、高频下单接口、课程详情接口

- **电商平台（可选延伸场景）**
  - 商品搜索 / 加入购物车 / 提交订单 / 支付回调
  - 典型压测目标：搜索接口、提交订单接口、库存扣减相关接口

> 实际项目中，你可以直接复用「接口自动化」中已经配置好的接口作为压测对象。

### 1.3 技术架构（压测相关）

- **后端**：Spring Boot + MyBatis-Plus + MySQL  
- **压测引擎**：
  - 内置 **Simple 模式**：轻量级 HTTP 压测（适合接口级压测）  
  - **JMX 模式**：集成 JMeter，支持上传/管理 JMX 脚本，适合复杂场景  
- **报告数据存储**：`glen_stress` 库中的 `report` / `report_detail_stress` 表  

---

## 二、快速上手（5 分钟 Demo）

### 2.1 前置条件

- Glen 自动化云测平台已部署并可访问  
- MySQL 服务与 `glen_stress` / `glen_engine` / `glen_dict` 等库已初始化（执行过 `init-database.sh`）  
- 已完成接口自动化 Mock 场景配置（参考《接口自动化-MOCK- 完整配置使用手册》）

### 2.2 登录与项目选择

1. 使用管理员账号登录 Glen 自动化云测平台  
2. 在顶部项目下拉中，选择：
   - **在线教育平台项目**：例如 `花桥学堂`  
   - 或你已配置好的电商平台项目

### 2.3 最小可运行压测 Demo 流程

1. 在当前项目下，进入 **「压测引擎 → 用例管理」**  
2. 创建一个 **压测模块**（如：`课程接口压测`）  
3. 在模块下创建一个 **压测用例**：对 `/courses` 课程列表接口做并发压测  
4. 配置 **压测参数**（线程数、持续时间等）  
5. 选择 **测试环境**（如 `花桥学堂测试环境`）  
6. 点击 **执行**，观察压测报告与曲线图  

以下章节将详细拆解上面的每一步。

---

## 三、项目与环境准备（复用接口自动化配置）

> 如果你已经按照接口自动化手册配置好项目和环境，本章节可快速浏览后直接跳到「四、压测基础配置」。

### 3.1 项目配置（在线教育平台示例）

- **操作路径**：`公共菜单` → `项目管理`  
- 推荐项目配置（与接口自动化保持一致）：

| 配置项   | 值                       | 说明                                       |
|----------|-------------------------|--------------------------------------------|
| 项目名称 | 花桥学堂（在线教育平台） | 包含课程、考试、证书等完整业务             |
| 描述     | 在线教育平台完整压测场景 | 与接口自动化复用同一业务背景               |

> 压测引擎使用 `projectId` 做隔离，只要在同一项目下，接口自动化与压测可以共享环境与部分配置。

### 3.2 环境配置（与接口自动化共享）

- **操作路径**：`进入项目` → `环境管理`  
- 推荐环境（示例）：

| 环境名称           | 协议 | 域名       | 端口 | 说明                     |
|--------------------|------|------------|------|--------------------------|
| 花桥学堂测试环境   | HTTP | localhost | 3000 | 对接本地 Mock/测试服务   |
| 花桥学堂生产测试   | HTTP | localhost | 3001 | 生产模拟环境/预发布环境 |

> 压测执行时需要选择环境，以便构造出完整的请求 URL。

---

## 四、压测基础配置

### 4.1 压测模块管理

- **操作路径**：`压测引擎` → `用例管理`  

左侧为「压测模块」树形结构，用于按业务模块组织压测用例。推荐做法：

#### 4.1.1 在线教育平台示例模块

| 模块名称         | 说明                         |
|------------------|------------------------------|
| 课程接口压测     | 课程列表、课程详情相关接口   |
| 下单与支付压测   | 提交订单、支付回调相关接口   |
| 学习记录压测     | 学习进度、学习列表相关接口   |

创建步骤：

1. 点击左侧模块区域的 `+` 按钮  
2. 输入模块名称（如：`课程接口压测`）  
3. 选择所属项目（当前项目自动带出）  
4. 保存即可

### 4.2 压测用例基础信息

在某个模块下，可以创建多个压测用例，每个压测用例一般对应一个 **接口** 或 **业务场景**。

#### 4.2.1 压测类型选择

Glen 压测引擎支持两种压测模式：

| 压测类型 | 说明 | 适用场景 |
|---------|------|---------|
| **SIMPLE** | 简单模式，在平台上直接配置压测参数 | 单接口压测、快速压测验证、简单业务场景 |
| **JMX** | 使用 JMeter JMX 脚本，支持复杂场景 | 复杂业务流程压测、多接口编排、已有 JMeter 脚本复用 |

**选择建议**：
- **推荐使用 SIMPLE 模式**：如果只需要压测单个接口，使用 SIMPLE 模式更简单快捷
- **使用 JMX 模式**：如果需要复杂的测试场景（如多接口编排、CSV 参数化、条件判断等），可以使用 JMX 模式

核心字段示例：

| 字段           | 示例值                  | 说明                                   |
|----------------|------------------------|----------------------------------------|
| 用例名称       | 课程列表接口压测       | 人类可读的名称                         |
| 所属模块       | 课程接口压测           | 归属关系                               |
| 压测来源类型   | SIMPLE / JMX           | SIMPLE = 直接配置；JMX = 使用 JMeter  |
| 请求方法       | GET                    | GET/POST/PUT/DELETE 等（仅 SIMPLE 模式需要） |
| 请求路径       | /courses               | 不含域名与协议（仅 SIMPLE 模式需要）   |
| 描述           | 验证课程列表接口在高并发下性能 | 方便在报告中识别                       |

请求相关字段（与接口自动化类似）：

- `query`：查询参数（如 `page=1&limit=10`）  
- `header`：请求头（如 `Content-Type`、鉴权头）  
- `body` / `bodyType`：请求体与格式（适用于 POST/PUT）

### 4.3 压测参数配置（线程组）

压测参数主要用于控制 **并发数** 与 **持续时间**。在 Simple 模式下，一般会配置：

#### 4.3.1 核心参数说明

| 参数名称 | 字段名 | 示例值 | 说明 | 注意事项 |
|---------|--------|--------|------|---------|
| **线程组名称** | `threadGroupName` | "50" | 线程组的标识名称，便于在报告中识别 | 通常与线程数保持一致 |
| **并发数量** | `numThreads` | 50 | **就是线程数**，每个线程代表一个并发虚拟用户 | 并发数量 = 线程数，例如 50 表示同时有 50 个用户并发请求 |
| **启动时间（秒）** | `rampUp` | 10 | **线程组启动时间**，从 0 个线程逐渐增加到目标线程数所需的时间（秒） | 例如：50 线程 + 10 秒启动时间 = 每 0.2 秒启动 1 个线程 |
| **循环次数** | `loopCount` | 1 | 每个线程执行测试计划的次数 | -1 = 永久循环（需配合调度器）；0 = 由持续时间控制；>0 = 固定次数 |
| **是否开启调度器** | `schedulerEnabled` | false | 是否启用调度器来控制压测的精确时间 | 关闭时：由循环次数控制；开启时：由持续时间控制 |
| **持续时间（秒）** | `duration` | 300 | **调度器启用后**，压测持续的总时间（秒） | 仅在 `schedulerEnabled=true` 时生效 |
| **启动延迟（秒）** | `delay` | 0 | **调度器启用后**，延迟多久才开始执行压测（秒） | 仅在 `schedulerEnabled=true` 时生效 |

#### 4.3.2 参数关系与执行时序

**场景一：调度器关闭（`schedulerEnabled=false`）**

```
时间轴：
0秒 ──────────────────────────────────────────> 结束
    │
    ├─ 启动时间（rampUp）：10秒内从0线程增加到50线程
    │  每0.2秒启动1个线程
    │
    └─ 循环次数（loopCount）：每个线程执行1次后停止
```

**示例配置**：
- 并发数量：50
- 启动时间：10秒
- 循环次数：1
- 调度器：关闭

**执行结果**：10秒内启动50个线程，每个线程执行1次请求后结束。

---

**场景二：调度器开启（`schedulerEnabled=true`）**

```
时间轴：
0秒 ──────────────────────────────────────────> 结束
    │
    ├─ 启动延迟（delay）：等待5秒后才开始
    │
    ├─ 启动时间（rampUp）：10秒内从0线程增加到50线程
    │
    └─ 持续时间（duration）：从开始执行起持续300秒
```

**示例配置**：
- 并发数量：50
- 启动时间：10秒
- 循环次数：-1（永久循环）
- 调度器：开启
- 启动延迟：5秒
- 持续时间：300秒

**执行结果**：
1. 等待5秒（启动延迟）
2. 在10秒内启动50个线程（启动时间）
3. 50个线程持续运行300秒（持续时间），每个线程循环执行请求
4. 300秒后所有线程停止

#### 4.3.3 三个时间参数的区别总结

| 参数 | 作用时机 | 作用对象 | 典型场景 |
|------|---------|---------|---------|
| **启动时间（rampUp）** | 压测开始时 | 线程启动过程 | 避免瞬间高并发冲击系统，平滑启动 |
| **持续时间（duration）** | 调度器开启后 | 整个压测过程 | 需要精确控制压测时长，如"压测5分钟" |
| **启动延迟（delay）** | 调度器开启后 | 压测开始前 | 等待系统准备就绪，或定时执行压测 |

#### 4.3.4 推荐配置示例

**快速压测（功能验证）**：
- 并发数量：10
- 启动时间：5秒
- 循环次数：1
- 调度器：关闭

**稳定性压测（长时间运行）**：
- 并发数量：50
- 启动时间：30秒
- 循环次数：-1
- 调度器：开启
- 启动延迟：0秒
- 持续时间：600秒（10分钟）

**峰值压测（模拟秒杀场景）**：
- 并发数量：200
- 启动时间：5秒（快速达到峰值）
- 循环次数：-1
- 调度器：开启
- 启动延迟：0秒
- 持续时间：60秒（1分钟峰值）

> 对应到 JMeter 概念：线程数（numThreads）、Ramp-Up（rampUp）、循环次数（loopCount）、调度器（Scheduler）等。

### 4.4 压测断言与监控

压测用例支持配置 **断言信息**（存储在 `assertion` 字段中），用于判定请求在压力下是否依然业务正确：

- **断言来源**（`stress_assert_from`）：
  - `RESPONSE_CODE`：响应状态码  
  - `RESPONSE_HEADER`：响应头  
  - `RESPONSE_DATA`：响应体内容  
  - `RESPONSE_TIME`：响应时间

- **断言动作**（`stress_assert_action`）：
  - `EQUAL` / `NOT_EQUAL`  
  - `CONTAIN` / `NOT_CONTAIN`  
  - `GREAT_THEN` / `LESS_THEN`（数值比较）

常见断言示例：

- 状态码必须为 200  
- 响应时间小于 500ms  
- 响应体中包含 `"success": true`

> 对应的字典数据已经在 `sys_dict` 中预置：`stress_source_type`、`stress_assert_action`、`stress_assert_from`。

---

## 五、JMX 压测脚本使用指南

JMX 模式允许你上传 JMeter 脚本（`.jmx` 文件）进行更复杂的压测场景。本章节详细介绍如何使用 JMX 模式。

### 5.1 JMX 模式概述

#### 5.1.1 JMX 模式特点

- ✅ **支持复杂测试场景**：多接口编排、条件判断、循环控制
- ✅ **复用现有 JMeter 脚本**：直接使用已有的 JMX 文件
- ✅ **CSV 参数化支持**：自动处理 JMX 脚本中的 CSV 数据文件配置
- ✅ **完整 JMeter 功能**：支持 JMeter 的所有功能特性

#### 5.1.2 JMX 模式与 SIMPLE 模式对比

| 特性 | SIMPLE 模式 | JMX 模式 |
|------|------------|---------|
| 配置方式 | 平台界面配置 | 上传 JMX 脚本 |
| 适用场景 | 单接口压测 | 复杂场景压测 |
| 环境配置 | 需要选择环境 | JMX 脚本中已配置 |
| CSV 参数化 | 支持 | 支持（自动处理） |
| 多接口编排 | 不支持 | 支持 |
| 学习成本 | 低 | 中等（需要了解 JMeter） |

### 5.2 创建 JMX 脚本

#### 5.2.1 使用 JMeter 创建脚本

1. **下载并安装 JMeter**
   - 访问 Apache JMeter 官网：https://jmeter.apache.org/
   - 下载 JMeter 5.5 或更高版本
   - 解压到本地目录

2. **启动 JMeter GUI**
   ```bash
   # Windows
   jmeter.bat
   
   # Linux/Mac
   ./jmeter.sh
   ```

3. **创建测试计划**
   - 打开 JMeter，会自动创建一个空的测试计划
   - 右键 `Test Plan` → `Add` → `Threads (Users)` → `Thread Group`
   - 配置线程组参数（线程数、Ramp-Up、循环次数等）

4. **添加 HTTP 请求**
   - 右键 `Thread Group` → `Add` → `Sampler` → `HTTP Request`
   - 配置请求参数（服务器名称/IP、端口、路径、方法等）

5. **添加断言（可选）**
   - 右键 `HTTP Request` → `Add` → `Assertions` → `Response Assertion`
   - 配置断言规则

6. **保存为 JMX 文件**
   - `File` → `Save Test Plan As...`
   - 保存为 `.jmx` 文件

#### 5.2.2 简单的 JMX 脚本示例

创建一个压测课程列表接口的 JMX 脚本：

**测试计划结构**：
```
Test Plan (课程列表接口压测)
└── Thread Group
    ├── HTTP Request (课程列表)
    │   └── Response Assertion (状态码=200)
    └── Summary Report (监听器)
```

**Thread Group 配置**：
- **Threads (Users)**: 50
- **Ramp-Up Period**: 10
- **Loop Count**: 1

**HTTP Request 配置**：
- **Server Name**: localhost
- **Port**: 3000
- **Path**: /courses
- **Method**: GET
- **Parameters**: page=1&limit=10

#### 5.2.3 CSV 参数化配置（可选）

如果需要在 JMX 脚本中使用 CSV 参数化：

1. **创建 CSV 文件**
   ```csv
   userId,courseId
   1001,2001
   1002,2002
   1003,2003
   ```

2. **在 JMeter 中添加 CSV 数据文件配置**
   - 右键 `Thread Group` → `Add` → `Config Element` → `CSV Data Set Config`
   - 配置：
     - **Filename**: `/path/to/your/data.csv`（或相对路径）
     - **Variable Names**: `userId,courseId`
     - **Delimiter**: `,`（逗号）
     - **Recycle on EOF**: True（循环使用）
     - **Stop thread on EOF**: False

3. **在 HTTP 请求中使用变量**
   - 路径或参数中使用 `${userId}`、`${courseId}` 引用变量

> **注意**：上传 JMX 脚本到平台时，CSV 文件需要与 JMX 文件一起上传到 MinIO。系统会自动处理 CSV 文件的路径关联。

### 5.3 在平台中使用 JMX 脚本

#### 5.3.1 上传 JMX 脚本

1. **创建压测用例**
   - 进入 `压测引擎` → `用例管理`
   - 点击 `+` 按钮创建新用例

2. **选择压测类型**
   - 在 `选择压测类型` 下拉框中选择 **JMX**

3. **上传 JMX 文件**
   - 点击 `上传 JMX 脚本` 区域的按钮
   - 选择本地 `.jmx` 文件
   - 文件会自动上传到 MinIO 对象存储
   - 上传成功后，按钮显示为 `已上传`

4. **填写用例信息**
   - **用例名称**：例如 `课程列表接口压测（JMX）`
   - **用例描述**：描述压测目标和场景

5. **保存用例**
   - 点击保存，JMX 脚本的 URL 会自动保存到数据库中

> **注意**：
> - JMX 模式下不需要选择环境（环境配置在 JMX 脚本中）
> - 不需要配置请求方法、路径等（已在 JMX 脚本中配置）
> - 线程组配置也在 JMX 脚本中，不需要在平台上配置

#### 5.3.2 JMX 脚本的 CSV 参数化支持

如果 JMX 脚本中使用了 CSV 参数化：

1. **在 JMeter 中配置 CSV Data Set Config**
   - CSV 文件路径使用相对路径（相对于 JMX 文件位置）
   - 例如：`data.csv` 或 `./data.csv`

2. **上传 CSV 文件（如需要）**
   - 如果需要更新 CSV 数据，可以通过文件管理功能上传
   - CSV 文件会上传到 MinIO，系统会自动关联

3. **系统自动处理**
   - 执行压测时，系统会自动解析 JMX 脚本中的 CSV 配置
   - 自动下载 CSV 文件并与 JMX 脚本关联
   - 无需手动配置 CSV 文件路径

#### 5.3.3 执行 JMX 压测

1. **选择用例**
   - 在用例列表中找到要执行的 JMX 压测用例

2. **点击执行**
   - 点击 `执行` 按钮
   - 系统会自动：
     - 从 MinIO 下载 JMX 文件
     - 加载测试计划树
     - 处理 CSV 参数化（如有）
     - 添加结果收集器
     - 启动 JMeter 引擎执行压测

3. **查看报告**
   - 压测执行完成后，在 `测试报告` 中查看结果
   - 报告格式与 SIMPLE 模式相同

### 5.4 JMX 脚本最佳实践

#### 5.4.1 JMX 脚本编写建议

1. **使用变量和属性**
   - 服务器地址、端口等使用变量配置，便于切换环境
   - 例如：`${__P(server.host,localhost)}`、`${__P(server.port,3000)}`

2. **合理使用监听器**
   - 在平台上执行时，系统会自动添加结果收集器
   - 可以移除 JMX 脚本中的自定义监听器，减少资源消耗

3. **优化线程组配置**
   - 线程数、Ramp-Up 等参数在 JMX 脚本中配置
   - 执行时直接使用脚本中的配置

4. **使用断言验证结果**
   - 在 JMX 脚本中添加断言，验证响应正确性
   - 系统会在报告中记录断言结果

#### 5.4.2 常见 JMX 脚本场景

**场景一：单接口压测**
```
Thread Group
└── HTTP Request
    └── Response Assertion
```

**场景二：多接口顺序压测**
```
Thread Group
├── HTTP Request 1 (登录)
├── HTTP Request 2 (获取列表)
└── HTTP Request 3 (查看详情)
```

**场景三：参数化压测**
```
Thread Group
├── CSV Data Set Config
└── HTTP Request (使用 ${variable} 引用 CSV 数据)
```

**场景四：条件判断压测**
```
Thread Group
├── HTTP Request 1
├── If Controller (判断条件)
│   └── HTTP Request 2 (条件满足时执行)
└── HTTP Request 3
```

### 5.5 JMX 模式常见问题

#### 5.5.1 JMX 文件上传失败

**可能原因**：
- 文件大小超过限制
- 文件格式不正确（必须是 `.jmx` 文件）
- MinIO 服务未启动

**解决方案**：
- 检查文件大小和格式
- 确认 MinIO 服务正常运行（访问 http://localhost:9001）
- 查看浏览器控制台错误信息

#### 5.5.2 执行时找不到 CSV 文件

**可能原因**：
- CSV 文件未上传到 MinIO
- JMX 脚本中的 CSV 路径配置不正确

**解决方案**：
- 确保 CSV 文件与 JMX 脚本一起上传
- 检查 JMX 脚本中 CSV Data Set Config 的路径配置
- 使用相对路径而不是绝对路径

#### 5.5.3 压测执行失败

**可能原因**：
- JMX 脚本语法错误
- 服务器地址或端口配置错误
- 缺少必要的组件或插件

**解决方案**：
- 在 JMeter GUI 中测试脚本是否能正常运行
- 检查 JMX 脚本中的服务器配置
- 查看后端日志（`glen-engine` 服务日志）获取详细错误信息

### 5.6 JMX 模式与 SIMPLE 模式对比示例

**示例：压测课程列表接口**

**SIMPLE 模式配置**：
- 选择压测类型：SIMPLE
- 请求方法：GET
- 请求路径：/courses
- 线程数：50
- Ramp-Up：10秒
- 环境：选择已配置的环境

**JMX 模式配置**：
- 选择压测类型：JMX
- 上传 JMX 脚本：course_list.jmx
- （JMX 脚本中已包含所有配置）

**对比**：
- SIMPLE 模式：配置简单，适合快速压测
- JMX 模式：需要先创建 JMX 脚本，但支持更复杂的场景

> **推荐**：对于简单的单接口压测，优先使用 SIMPLE 模式；对于复杂的多接口编排、条件判断等场景，使用 JMX 模式。

---

## 六、在线教育平台压测实战

本章节给出一套与「接口自动化-MOCK 手册」完全对齐的压测配置方案，适用于演示「功能 + 性能」一体化。

### 6.1 场景一：课程列表接口压测（SIMPLE 模式）

**测试目标**：

- 在 50 并发、持续 5 分钟的情况下，课程列表接口 P95 响应时间 < 300ms，错误率 < 1%

> **说明**：本示例使用 SIMPLE 模式，如需了解 JMX 模式的使用，请参考第五章。

#### 6.1.1 用例基础信息

| 字段       | 配置值             |
|------------|--------------------|
| 用例名称   | 课程列表接口压测   |
| 所属模块   | 课程接口压测       |
| 压测类型   | SIMPLE             |
| 请求方法   | GET                |
| 请求路径   | /courses           |

#### 6.1.2 请求参数

- **查询参数**：

```json
{
  "page": "1",
  "limit": "10"
}
```

- **请求头**：

```json
[
  {
    "key": "Content-Type",
    "value": "application/json; charset=utf-8"
  }
]
```

#### 6.1.3 压测参数

| 参数         | 值   |
|--------------|------|
| 线程数       | 50   |
| Ramp-Up 时间 | 10s  |
| 持续时间     | 300s |

#### 6.1.4 断言配置

- 断言 1：响应状态码等于 200  
- 断言 2：响应时间小于 500ms  

> 可以在 `assertion` 字段中以 JSON 形式保存断言规则，压测引擎会在报告中记录每次采样是否满足要求。

### 6.2 场景二：创建订单压测（教育-报名课程）

**测试目标**：

- 在 20 并发、10 分钟压测下，创建订单接口无超时、错误率低于 0.5%

基础信息示例：

| 字段       | 配置值                 |
|------------|------------------------|
| 用例名称   | 报名课程下单接口压测   |
| 请求方法   | POST                   |
| 请求路径   | /orders                |
| 压测类型   | SIMPLE                 |

请求体（示例）：

```json
{
  "courseId": "{{course_id}}",
  "userCode": "USER001",
  "payType": "ONLINE",
  "price": 299
}
```

压测参数推荐：

| 参数         | 值   |
|--------------|------|
| 线程数       | 20   |
| Ramp-Up 时间 | 20s  |
| 持续时间     | 600s |

断言：

- 状态码等于 200 或 201  
- 响应体中包含 `"orderId"` 字段  

> 结合接口自动化中的关联参数能力，可以先通过接口自动化用例准备课程与用户数据，再用压测引擎针对「下单接口」进行大规模压测。

---

## 七、电商平台压测示例（可复用模板）

本章节提供一个**真实公开的电商演示网站**压测示例，与你在《UI自动化-完整配置使用手册》中使用的 Swag Labs（`https://www.saucedemo.com/`）保持一致，方便在「UI 自动化 + 压测」两个维度做联合演示。

### 7.1 推荐模块

| 模块名称       | 说明                             |
|----------------|----------------------------------|
| 商品列表压测   | 列表页高并发访问                 |
| 商品详情压测   | 商品详情页访问与切换             |
| 加购与下单压测 | 加入购物车/提交订单链路（可选） |

> 说明：Swag Labs 是一个公开的电商演示网站，支持完整的「登录 → 浏览商品 → 加入购物车 → 结算」流程，非常适合作为电商场景的 UI 自动化与压测演示环境。

### 7.2 场景一：Swag Labs 首页压测（推荐）

**测试目标**：
- 在 30 并发、持续 3 分钟的情况下，Swag Labs 首页 P95 响应时间 < 500ms，错误率 < 1%

> **重要说明**：Swag Labs 的 `/inventory.html`（商品列表页）需要先登录才能访问，直接访问会返回 400 错误。因此推荐压测首页 `/`，该页面无需登录即可访问。

#### 7.2.1 用例基础信息

| 字段       | 配置值                           |
|------------|----------------------------------|
| 用例名称   | Swag Labs 首页压测               |
| 所属模块   | 商品列表压测                     |
| 请求方法   | GET                              |
| 请求路径   | `/`                              |
| 压测类型   | SIMPLE                           |
| 环境域名   | `www.saucedemo.com`              |
| 环境协议   | HTTPS                            |
| 环境端口   | 443                              |

#### 7.2.2 请求参数

- **查询参数**：无需查询参数（商品列表页面直接访问）

- **请求头**（**必须配置**，否则 Swag Labs 会返回 400 错误）：

```json
[
  {
    "key": "User-Agent",
    "value": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
  },
  {
    "key": "Accept",
    "value": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8"
  },
  {
    "key": "Accept-Language",
    "value": "zh-CN,zh;q=0.9,en;q=0.8"
  },
  {
    "key": "Accept-Encoding",
    "value": "gzip, deflate, br"
  }
]
```

> **重要提示**：Swag Labs 的 CDN 对请求头有严格要求，缺少 `Accept` 头会导致 400 Bad Request。请务必在压测用例中配置上述请求头。

#### 7.2.3 压测参数

| 参数         | 值   | 说明                           |
|--------------|------|--------------------------------|
| 线程数       | 30   | 30 个并发用户                  |
| Ramp-Up 时间 | 10s  | 10 秒内从 0 增加到 30 个线程   |
| 循环次数     | 1    | 每个线程执行 1 次              |
| 调度器       | 关闭 | 不使用调度器，由循环次数控制   |

#### 7.2.4 断言配置

- **断言 1**：响应状态码等于 200
  ```json
  {
    "name": "响应状态码",
    "action": "EQUAL",
    "from": "RESPONSE_CODE",
    "value": "200"
  }
  ```

- **断言 2**：响应体包含 "Swag Labs"（验证页面加载成功）
  ```json
  {
    "name": "页面标题验证",
    "action": "CONTAIN",
    "from": "RESPONSE_DATA",
    "value": "Swag Labs"
  }
  ```

> **注意**：
> 1. 由于 Swag Labs 是公共演示站点，请合理控制压测强度，建议线程数不超过 50，持续时间不超过 5 分钟。
> 2. **如果压测 `/inventory.html` 返回 400 错误**：这是因为该页面需要登录后才能访问。解决方案：
>    - **方案 A（推荐）**：压测首页 `/`，无需登录即可访问
>    - **方案 B**：使用本地 Mock 服务模拟商品列表接口进行压测（见 7.2.5）
>    - **方案 C**：如果需要压测商品列表页，需要先通过 UI 自动化完成登录获取 Session，然后在压测请求头中携带 Cookie（此方案较复杂，不推荐）

#### 7.2.5 替代方案：使用本地 Mock 服务压测商品列表接口

如果你希望压测商品列表相关的接口（而非页面），可以使用本项目的 Mock 服务：

| 字段       | 配置值                           |
|------------|----------------------------------|
| 用例名称   | 商品列表接口压测（Mock）         |
| 请求方法   | GET                              |
| 请求路径   | /products/search                 |
| 查询参数   | `keyword=手机&page=1`            |
| 环境域名   | `localhost`                      |
| 环境协议   | HTTP                             |
| 环境端口   | 3000（Mock Server）              |

这样可以在完全可控的环境下进行压测，不受 Swag Labs 登录限制影响。

---

## 八、压测执行与报告解读

### 8.1 压测执行入口

- **操作路径**：`压测引擎` → `用例管理`  
- 在用例列表中，点击 **「执行」** 按钮：
  1. 选择环境（如 `花桥学堂测试环境`）  
  2. 确认压测参数与断言配置  
  3. 点击确认，压测任务进入执行队列  

### 8.2 报告查看

压测完成后，可在：

- `压测引擎` → `压测报告`（若前端有此菜单）  
- 或在用例行操作中点击「查看报告」

报告中通常包含：

- 请求总数、成功数、失败数、错误率  
- 平均响应时间、P90、P95、P99  
- 吞吐量（Requests/sec）  
- 每秒接收/发送 KB (`receive_k_b_per_second` / `sent_k_b_per_second`)  
- 详细采样数据（存储于 `report_detail_stress`）：
  - `response_code`、`sample_time`、`sampler_label` 等

> 对于面试/演示场景，重点展示：**压测参数配置** → **实时曲线** → **关键指标（错误率/P95）**。

---

## 九、与接口/ UI 自动化的协同策略

为了在面试/项目评审中形成一个「完整测试故事」，推荐如下组合策略：

- **接口自动化**：覆盖所有核心接口的功能正确性  
- **UI 自动化**：覆盖关键用户路径（如「从首页到完成支付」）  
- **压测引擎**：
  - 对接口自动化中的 P0/P1 接口做定期压测  
  - 针对 UI 自动化覆盖的关键业务链路，选取 1～2 个核心接口做高并发压测

示例组合（在线教育平台）：

1. 接口自动化：验证 `/categories`、`/courses`、`/orders` 功能正确  
2. UI 自动化：模拟用户登录、选课、下单、查看课程  
3. 压测引擎：对 `/courses` 和 `/orders` 做 30～50 并发压测，观察在压力下是否仍然可用

---

## 十、常见问题与故障排查

### 10.1 压测用例执行返回「系统异常」

可能原因：

- 数据库表未初始化或表名不一致  
- 字典数据缺失（`stress_source_type` / `stress_assert_action` / `stress_assert_from` 为空）  

排查步骤：

1. 检查 `glen_engine.stress_case_module`、`glen_stress.stress_case`、`glen_stress.report` 是否存在  
2. 在 `glen_dict.sys_dict` 中执行：

```sql
SELECT * FROM sys_dict 
WHERE category IN ('stress_source_type','stress_assert_action','stress_assert_from');
```

如为空，可执行项目内的 `sql/add_stress_dict_data.sql` 补齐字典。

### 10.2 点击「新增用例」页面不跳转

原因与解决：

- 当前项目下 **没有压测模块** 或 **未选中模块**  
- 解决：先在左侧创建模块，并选中模块后再点击「新增用例」

### 10.3 报告中没有任何采样数据

可能原因：

- 请求路径或环境配置错误，请求未发出  
- 请求被网关/防火墙拦截  
- 后端压测任务执行失败，可查看后端日志（`glen-engine` 服务日志）

---

## 十一、演示脚本建议（面试/评审用）

如果你需要在 10～15 分钟内完整演示压测功能，可以参考以下脚本：

1. **介绍平台与业务背景（2 分钟）**
   - 在线教育平台：课程、考试、证书  
   - 接口自动化 + UI 自动化 + 压测形成完整质量闭环
2. **展示已配置好的接口自动化用例（2 分钟）**
3. **在压测引擎中创建「课程列表接口压测」用例（3 分钟）**
   - 选择模块、填写路径 `/courses`、配置 50 并发  
4. **执行压测并讲解报告（3～5 分钟）**
   - 指出响应时间、错误率、吞吐量等关键指标  
5. **补充说明电商/其他业务也可以用同样方式配置（2 分钟）**

> 至此，一套围绕「真实业务 + 功能 + 性能」的完整测试故事就搭建完成了。

---

**文档位置**: `/home/hinkad/yun-glenautotest/markdown/压测引擎-完整配置使用手册.md`  
**最后更新**: 2026-01-21
