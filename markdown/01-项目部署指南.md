# 🚀 Glen自动化测试平台 - 项目部署指南

**更新时间**: 2026-01-18  
**环境**: WSL2 / Linux

---

## 📋 目录

- [一、环境准备](#一环境准备)
- [二、Docker中间件部署](#二docker中间件部署)
- [三、数据库初始化](#三数据库初始化)
- [四、后端服务部署](#四后端服务部署)
- [五、前端服务部署](#五前端服务部署)
- [六、完整系统访问地址](#六完整系统访问地址)

---

## 一、环境准备

### 1.1 必需软件

| 软件 | 版本要求 | 说明 |
|------|---------|------|
| **JDK** | 17+ | Java开发环境 |
| **Maven** | 3.9+ | Java构建工具 |
| **Node.js** | 18+ | 前端运行环境 |
| **pnpm** | 8.8.0+ | 前端包管理器 |
| **Docker** | 最新版 | 容器运行环境 |

### 1.2 环境检查

```bash
# 检查Java
java -version  # 应显示 17.x.x

# 检查Maven
mvn -version   # 应显示 3.9.x

# 检查Node.js
node -v        # 应显示 18.x.x 或更高

# 检查pnpm
pnpm -v        # 应显示 8.8.0 或更高

# 检查Docker
docker --version
docker-compose --version
```

---

## 二、Docker中间件部署

### 2.1 启动所有中间件

```bash
cd /home/hinkad/yun-glenautotest
docker-compose up -d
```

### 2.2 中间件清单

| 服务 | 容器名 | 端口 | 说明 |
|------|--------|------|------|
| **MySQL** | glen-mysql | 3307 | 数据库 |
| **Redis** | glen-redis | 6379 | 缓存 |
| **Nacos** | glen-nacos | 8848, 9848, 9849 | 服务注册中心 |
| **Zookeeper** | glen-zookeeper | 2181 | 协调服务 |
| **Kafka** | glen-kafka | 9092 | 消息队列 |
| **MinIO** | glen-minio | 9000, 9001 | 对象存储 |

### 2.3 验证中间件

```bash
# 查看所有容器状态
docker ps

# 查看日志
docker-compose logs -f [服务名]
```

---

## 三、数据库初始化

### 3.1 执行初始化脚本

```bash
cd /home/hinkad/yun-glenautotest
./init-database.sh
```

### 3.2 手动初始化（Navicat）

1. 连接MySQL（localhost:3307）
2. 选择 `glen_account` 数据库
3. 按顺序执行SQL文件（见 `Mysql/` 目录）

### 3.3 数据库清单

- `glen_account` - 账号服务数据库
- `glen_data` - 数据服务数据库
- `glen_engine` - 引擎服务数据库
- `glen_api` - API服务数据库
- `glen_ui` - UI服务数据库
- `glen_stress` - 压力测试数据库
- `glen_job` - 任务服务数据库
- `glen_dict` - 字典服务数据库
- `nacos_config` - Nacos配置数据库

---

## 四、后端服务部署

### 4.1 启动所有后端服务（推荐）

```bash
cd /home/hinkad/yun-glenautotest
./start-backend.sh
```

### 4.2 停止后端服务

#### 4.2.1 使用脚本停止（推荐）

```bash
cd /home/hinkad/yun-glenautotest
./stop-backend.sh
```

**功能说明**：
- 停止所有 Spring Boot 进程
- 释放所有后端服务端口（8000, 8081, 8082, 8083）
- 显示停止结果

#### 4.2.2 手动停止

**方式1: 通过端口停止**
```bash
# 停止网关服务（端口8000）
lsof -ti :8000 | xargs kill -9 2>/dev/null

# 停止账号服务（端口8081）
lsof -ti :8081 | xargs kill -9 2>/dev/null

# 停止数据服务（端口8082）
lsof -ti :8082 | xargs kill -9 2>/dev/null

# 停止引擎服务（端口8083）
lsof -ti :8083 | xargs kill -9 2>/dev/null
```

**方式2: 通过进程名停止**
```bash
# 停止所有 Spring Boot 进程
pkill -9 -f "spring-boot:run"

# 或逐个停止
pkill -9 -f "glen-gateway"
pkill -9 -f "glen-account"
pkill -9 -f "glen-data"
pkill -9 -f "glen-engine"
```

### 4.3 清除后端服务

**清除端口占用和进程**：

```bash
cd /home/hinkad/yun-glenautotest
./cleanup-backend-ports.sh
```

**功能说明**：
- 强制停止所有 Spring Boot 进程
- 清理所有后端服务端口占用
- 显示端口状态（空闲/占用）

**手动清除**：
```bash
# 清理所有后端服务端口
for port in 8000 8081 8082 8083; do
    pid=$(lsof -ti :$port 2>/dev/null)
    if [ -n "$pid" ]; then
        kill -9 $pid 2>/dev/null
        echo "已清理端口 $port (PID: $pid)"
    fi
done

# 清理所有 Spring Boot 进程
pkill -9 -f "spring-boot:run"
```

### 4.4 重启后端服务

#### 4.4.1 使用脚本重启（推荐）

```bash
cd /home/hinkad/yun-glenautotest
./restart-backend.sh
```

**功能说明**：
- 自动停止现有服务
- 清理端口占用
- 重新启动所有服务

#### 4.4.2 手动重启步骤

```bash
# 步骤1: 停止服务
./stop-backend.sh

# 步骤2: 等待进程完全退出
sleep 3

# 步骤3: 清理端口（可选）
./cleanup-backend-ports.sh

# 步骤4: 启动服务
./start-backend.sh
```

### 4.5 手动启动各个服务

如果需要单独启动某个服务，或使用脚本启动失败，可以手动启动：

#### 4.5.1 启动网关服务（gateway-service）

```bash
cd /home/hinkad/yun-glenautotest/backend/glen-gateway
/mnt/d/apache-maven-3.9.11/bin/mvn spring-boot:run
```

**说明**: 网关服务需要最先启动，其他服务通过网关访问。

#### 4.5.2 启动账号服务（account-service）

```bash
cd /home/hinkad/yun-glenautotest/backend/glen-account
/mnt/d/apache-maven-3.9.11/bin/mvn spring-boot:run
```

**说明**: 账号服务提供用户认证和权限管理功能。

#### 4.5.3 启动数据服务（data-service）

```bash
cd /home/hinkad/yun-glenautotest/backend/glen-data
/mnt/d/apache-maven-3.9.11/bin/mvn spring-boot:run
```

**说明**: 数据服务提供数据管理和报表功能。

#### 4.5.4 启动引擎服务（engine-service）

```bash
cd /home/hinkad/yun-glenautotest/backend/glen-engine
/mnt/d/apache-maven-3.9.11/bin/mvn spring-boot:run
```

**说明**: 引擎服务提供项目管理、接口测试、UI测试、压力测试等功能。

#### 4.5.5 启动顺序建议

建议按以下顺序启动服务：

1. **gateway-service** (端口 8000) - 网关服务
2. **account-service** (端口 8081) - 账号服务
3. **data-service** (端口 8082) - 数据服务
4. **engine-service** (端口 8083) - 引擎服务

> **提示**: 如果Maven已配置到PATH，可以直接使用 `mvn spring-boot:run` 命令。

### 4.6 后端服务清单

| 服务 | 端口 | 说明 |
|------|------|------|
| **account-service** | 8081 | 账号服务 |
| **data-service** | 8082 | 数据服务 |
| **engine-service** | 8083 | 引擎服务 |
| **gateway-service** | 8000 | API网关 |

### 4.7 验证后端服务

```bash
# 检查端口监听
for port in 8081 8082 8083 8000; do
    timeout 2 bash -c "echo > /dev/tcp/localhost/$port" 2>/dev/null && echo "✅ 端口 $port: 运行中" || echo "❌ 端口 $port: 未运行"
done
```

### 4.8 常用命令汇总

**快速命令**：
```bash
# 启动所有后端服务
./start-backend.sh

# 停止所有后端服务
./stop-backend.sh

# 清除端口占用
./cleanup-backend-ports.sh

# 重启所有后端服务
./restart-backend.sh

# 验证服务状态
for port in 8081 8082 8083 8000; do
    timeout 2 bash -c "echo > /dev/tcp/localhost/$port" 2>/dev/null && echo "✅ 端口 $port: 运行中" || echo "❌ 端口 $port: 未运行"
done
```

**查看服务日志**：
```bash
# 查看所有服务日志
tail -f logs/account-service.log
tail -f logs/data-service.log
tail -f logs/engine-service.log
tail -f logs/gateway-service.log

# 查看单个服务日志
tail -f logs/engine-service.log

# 查看日志最后100行
tail -n 100 logs/engine-service.log

# 搜索日志中的错误
grep -i error logs/engine-service.log
grep -i exception logs/engine-service.log
```

**检查服务进程**：
```bash
# 查看所有Spring Boot进程
ps aux | grep "spring-boot:run"

# 查看特定服务进程
ps aux | grep "glen-engine"

# 查看端口占用
lsof -i :8083
netstat -tlnp | grep 8083
```

### 4.9 常见问题

**端口冲突**:
```bash
./cleanup-backend-ports.sh
```

**Maven命令未找到**:
```bash
source ~/.bashrc
# 或使用完整路径: /mnt/d/apache-maven-3.9.11/bin/mvn
```

---

## 五、前端服务部署

### 5.1 启动前端服务

```bash
cd /home/hinkad/yun-glenautotest
./start-frontend.sh
```

### 5.2 前端信息

| 项目 | 信息 |
|------|------|
| **框架** | Vue3 + Vite |
| **端口** | 5173 |
| **访问地址** | http://localhost:5173 |

### 5.3 验证前端

访问 http://localhost:5173，应该看到登录页面。

---

## 六、完整系统访问地址

### 🌐 主要访问地址

| 服务 | 访问地址 | 说明 |
|------|---------|------|
| **前端应用** | **http://localhost:5173** | ⭐ 主要访问入口 |
| **网关服务** | **http://localhost:8000** | API网关 |

### 🛠️ 管理控制台

| 服务 | 访问地址 | 用户名 | 密码 |
|------|---------|--------|------|
| **Nacos控制台** | http://localhost:8848/nacos | `nacos` | `nacos` |
| **MinIO控制台** | http://localhost:9001 | `admin` | `glen123456` |

### 🔌 后端服务

| 服务 | 访问地址 | 说明 |
|------|---------|------|
| **account-service** | http://localhost:8081 | 账号服务（直连） |
| **data-service** | http://localhost:8082 | 数据服务（直连） |
| **engine-service** | http://localhost:8083 | 引擎服务（直连） |

> **注意**: 后端服务建议通过网关（端口8000）访问。

---

## 📋 完整启动流程

1. ✅ 启动Docker中间件
   ```bash
   docker-compose up -d
   ```

2. ✅ 初始化数据库
   ```bash
   ./init-database.sh
   ```

3. ✅ 启动后端服务
   ```bash
   ./start-backend.sh
   ```

4. ✅ 启动前端服务
   ```bash
   ./start-frontend.sh
   ```

5. ✅ 访问系统
   - 前端: http://localhost:5173
   - 测试账号: `test` / `test123456`

---

## 🐛 常见问题

### Q1: 端口被占用

```bash
# 清理后端端口
./cleanup-backend-ports.sh

# 停止Docker容器
docker-compose down
```

### Q2: 数据库连接失败

- 检查MySQL容器是否运行: `docker ps | grep mysql`
- 检查端口是否正确（3307）
- 检查密码是否正确（glen123456）

### Q3: 服务无法访问

- 检查服务是否运行（检查端口）
- 检查防火墙设置
- WSL2环境检查端口转发

---

## 📚 相关文档

- `02-项目分析介绍.md` - 项目分析介绍
- `03-系统账号密码.md` - 系统账号密码
- `Glen自动化云测平台-贝好学贝壳公益-完整配置手册.md` - 完整配置手册

---

**文档位置**: `/home/hinkad/yun-glenautotest/markdown/01-项目部署指南.md`  
**最后更新**: 2026-01-18
